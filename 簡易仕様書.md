# 簡易仕様書

### 作者
小林玲仁
### アプリ名
サクッと!! レストラン検索

### 該当プロジェクトのリポジトリURL（GitHub)
https://github.com/02-rine/HotPepperGourmetSearch

### 実際の使用動画
README.mdを拝見してください。

### 不具合及び使用上の注意
- GPSを予めONにした状態でアプリを起動しないと、GPS検索画面（InputGPSActivity）でスピナーが永続的に回り続けます。
- ホットペッパーAPIとYahooAPIを使用するため、それぞれAPIキーが必要となります。ホットペッパーAPIのAPIキーは必須です。YahooAPIのAPIキーは必須ではなく、入力しない場合は電話番号が表示されません。

## 開発環境
### 開発環境
Android Studio 4.1.2

### 開発言語
Kotlin 1.4.30

## 動作対象端末・OS
### 動作対象OS
Android 8.0

### 仮想端末
- Nexus 5X
- Android 11.0

### 実機試験用端末
- SO-04H
- Android 8.0

## アプリケーション機能
### 機能概要（機能一覧）
- データベースへのアクセス：Roomを使用し、予定の内容を保存したデータベースにアクセスする。
- カレンダーの表示：CalendarViewにより、選択された日付を取得する。
- 時刻選択ダイアログの表示：時刻選択ダイアログにより、選択された時刻を取得する。
- Data Binding：予定の登録画面にData Bindingを使用し、Viewを管理する。
- LiveData：LiveDataにより、データベースの内容が変更されたことを検知し、予定一覧を表示する表に反映させる。
- ViewModel：ViewModelにより、変数の値を保持し続ける。

### 画面概要（画面一覧）
#### 検索条件入力画面（InputKeyActivity）

##### APIキーの入力を行う画面
- ホットペッパーAPIキーとYahooAPIキーの入力を行います。ホットペッパーAPIキーが間違っていた場合は、検索結果画面でエラーメッセージを表示します。YahooAPIキーが間違っていた場合は、店舗詳細画面で電話番号が表示されません。
- 入力完了ボタンを押すと予算の選択を行う画面に画面遷移します。

##### 予算の選択を行う画面（InputMealFeeActivity）
- 6つのボタンから1つを選び、予算の選択を行います。
- 予算ボタンを押すと検索範囲の選択を行う画面に画面遷移します。
- Backキーを押すと、APIキーの入力を行う画面に画面遷移します。

##### 検索範囲の選択を行う画面（InputLocationActivity）
- 5つのボタンから1つを選び、検索範囲の選択を行います。検索範囲の目安として、検索範囲を東京ドームに置き換えて、イメージしやすくしています。
- 検索範囲ボタンを押すとGPSの検索を行う画面に画面遷移します。

##### GPSの検索を行う画面（InputGPSActivity）
- GPSから現在地の緯度と経度を求めます。GPSの機能利用の許可を行っていない場合は、許可を求めるダイアログが表示されます。
- 緯度と経度を求めると、検索結果画面に画面遷移します。

#### 検索結果画面（SearchResultActivity ⇔ GourmetShopViewModel ⇔ GourmetShopRepository）
##### UIの表示・ユーザ操作を検知する画面（SearchResultActivity・SearchResultListAdapter）
- 検索条件入力画面によって、作成した検索データを使用して、店舗データをリスト（RecyclerView）として表示します。
- リストを作成する際は、SearchResultListAdapterを用いて、Itemの設定を行います。
- Itemは、店舗トップ写真・店舗名＋ジャンル・ディナー予算・交通アクセスが表示されます。
- Itemを押すと、店舗詳細画面に画面遷移します。
- ホットペッパーAPIキーが間違っている場合は、「APIキーが正しく入力されていません」とエラーメッセージが表示されます。
- 周辺の店舗件数が0件の場合は、「周辺にレストランがありません　検索範囲を広げてください」とエラーメッセージが表示されます。
- Backキーを押すと、検索範囲の選択を行う画面に画面遷移します。

##### データの管理・保存する画面（GourmetShopViewModel）
- ホットペッパーAPIのデータを管理します。
- SearchResultActivityから受け取った検索データを用いて、ホットペッパーAPIから周辺の店舗データを取得します。そのデータをLiveDataのobserveを用いて、SearchResultActivityに渡します。

##### ホットペッパーAPIからデータの取得する画面（GourmetShopRepository・HotPepperGourmetService）
- ホットペッパーAPIから店舗データを取得するために、Retrofit2の設定を行います。受け取ったJSON形式のデータはGsonを用いてパースします。
- HotPepperGourmetServiceは、検索クエリの設定を行います。レスポンスとして受け取る店舗データの設定は、GourmetShopで行います。

#### 店舗詳細画面（ShopDetailActivity ⇔ TelViewModel ⇔ TelRepository）
##### UIの表示・ユーザ操作を検知する画面（ShopDetailActivity）
- 検索結果画面で押されたItemの店舗詳細を表示します。
- 店舗トップ写真・店舗名・営業時間・住所・ジャンル・最寄り駅・予算・電話番号・魅力が表示されます。電話番号と魅力は、データがnullの時は、非表示となります。
- 地図検索ボタンを押すと、住所が地図アプリに渡され、住所の地点が表示されます。

##### データの管理・保存する画面（TelViewModel）
- YahooAPIのデータを管理します。
- ShopDetailActivityから受け取った店舗名を用いて、YahooAPIから電話番号と店舗名を取得します。
- YahooAPIから受け取った結果には、検索した店舗名に似ている店舗名も含まれているので、店舗名が完全に一致した電話番号だけを変数に格納します。
- DataBindingを用いて、TelViewModelの変数を表示します。

##### YahooAPIからデータの取得する画面（TelRepository・YahooService）
- YahooAPIから電話番号を取得するために、Retrofit2の設定を行います。受け取ったJSON形式のデータはGsonを用いてパースします。
- YahooServiceは、検索クエリの設定を行います。レスポンスとして受け取るデータの設定は、ShopTelで行います。 

### 使用しているAPI、SDK、ライブラリなど
- Data Binding
- ViewModel
- Coroutine
- LiveData
- Retrofit2
- Gson
- Glide
- RecyclerView

### アーキテクチャパターン
- MVVM（Model View ViewModel）

## コンセプトやポイント
### コンセプト
子供から大人まで、幅広い年齢層から使ってもらえるレストラン検索アプリ

### こだわったポイント
- 検索条件入力画面（APIキー・予算・検索範囲の入力）を3つの画面に分け、画面ごとの選択肢の数を減らすことで、画面ごとの入力に必要な労力を省きました。
- GPSの検索時にスピナー（ProgressBar）を用いて、読み込み時間を表現することで、ユーザの離脱を防ぐようにしました。
- 店舗詳細画面で地図検索を行えるボタンを付けたことにより、住所を覚えなくても、店舗までの経路を検索できるようにしました。

### デザイン面でこだわったポイント
- 検索条件の選択にボタンを用いて、文字入力を減らしたことにより、子供でも簡単に使いこなせるUIにしました。
- 検索条件入力画面で画像（鍵・GPS）を表示することにより、各画面で何を入力・選択する必要があるのか、瞬時に把握できるようにしました。
- アプリが外で利用されることを考慮して、親指（片手持ち）で操作しやすい位置に、検索条件の選択を行うボタンを配置しました。

### アドバイスして欲しいポイント
- RecyclerViewのAdapterでItemの設定をする際に、DataBindingを用いて設定する方法がわからないので、アドバイスをお願いします。
- GPSにより位置情報を検出する際に、GPS機能利用の許可を行うダイアログは表示できるのですが、GPS自体の利用をONにする方法がわからないので、アドバイスをお願いします。
- 検索条件入力画面の３つの画面（APIキー・予算・検索範囲の入力）で画面遷移をする際に、IntentのputExtra()メソッドを用いてデータを渡しているのですが、それを使わないで、データベースのように他の場所にデータを格納したり、取得したりする方法がありましたら、アドバイスをお願いします。（扱うデータが少なかったため、今回はデータベースを使用しませんでした。）

### 自己評価
見た目や使いやすさを工夫したことにより、幅広い年齢層に愛用してもらえるアプリを作ることができたと思います。しかし、GPSの不具合やコードの冗長性が目立つため、GPSやDataBindingを理解し、これらの問題を解決したいと考えています。
