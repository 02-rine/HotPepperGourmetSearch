# 簡易仕様書

### 作者
小林玲仁
### アプリ名
サクッと!! レストラン検索

### 該当プロジェクトのリポジトリURL（GitHub)
https://github.com/02-rine/HotPepperGourmetSearch

### 実際の使用動画
README.mdを拝見してください。

### 不具合及び使用上の注意
- GPSを予めONにした状態でアプリを起動しないと、GPS検索画面（InputGPSActivity）でスピナーが永続的に回り続けます。
- ホットペッパーAPIとYahooAPIを使用するため、それぞれAPIキーが必要となります。ホットペッパーAPIのAPIキーは必須です。YahooAPIのAPIキーは必須ではなく、入力しない場合は電話番号が表示されません。

### 使用したWebAPI
使用したWebAPIのURLを以下に示します。
- ホットペッパーグルメサーチAPI：https://webservice.recruit.co.jp/doc/hotpepper/reference.html
- Yahoo!ローカルサーチAPI：https://developer.yahoo.co.jp/webapi/map/openlocalplatform/v1/localsearch.html （店舗名から電話番号を取得する際に使います）
<br>

## 開発環境
### 開発環境
Android Studio 4.1.2

### 開発言語
Kotlin 1.4.30

<br>

## 動作対象端末・OS
### 動作対象OS
Android 8.0

### 仮想端末
- Nexus 5X
- Android 11.0

### 実機試験用端末
- SO-04H
- Android 8.0
<br>

## アプリケーション機能
### 機能概要（機能一覧）
- 店舗検索：GPSを用いて周辺のレストランを検索します。
- 地図アプリ連携：地図アプリの連携により、店舗の場所を表示することができます。
- リスト表示：RecyclerViewを用いて、店舗データをリストとして表示します。
<br>

### DataClass
- SearchData：検索データ。ホットペッパーAPIに渡して、店舗データを取得する。
- GourmetShop：店舗データ。ホットペッパーAPIから受け取るデータの設定を行う。
- ShopTel：電話番号と店舗名。YahooAPIから受け取るデータの設定を行う。
<br>

### 画面概要（画面一覧）
#### 検索条件入力画面
各画面でデータの入力や選択を行い、検索データ（SearchData）を作成します。

##### APIキーの入力を行う画面（InputKeyActivity）
- ホットペッパーAPIキーとYahooAPIキーの入力を行います。ホットペッパーAPIキーが間違っている場合は、検索結果画面でエラーメッセージを表示します。YahooAPIキーが間違っている場合は、店舗詳細画面で電話番号が表示されません。
- 入力完了ボタンを押すと、予算の選択を行う画面に画面遷移します。

##### 予算の選択を行う画面（InputMealFeeActivity）
- 6つのボタンから、予算の選択を行います。
- 予算ボタンを押すと、検索範囲の選択を行う画面に画面遷移します。
- Backキーを押すと、APIキーの入力を行う画面に画面遷移します。

##### 検索範囲の選択を行う画面（InputLocationActivity）
- 5つのボタンから、検索範囲の選択を行います。検索範囲の目安として、検索範囲を「東京ドーム」に置き換えて、イメージしやすくしています。
- 検索範囲ボタンを押すと、GPSの検索を行う画面に画面遷移します。

##### GPSの検索を行う画面（InputGPSActivity）
- GPSから現在地の緯度と経度を求めます。GPSの機能利用の許可を行っていない場合は、許可を求めるダイアログが表示されます。
- 緯度と経度を求めると、検索結果画面に画面遷移します。
<br>

#### 検索結果画面（MVVM：SearchResultActivity ⇔ GourmetShopViewModel ⇔ GourmetShopRepository）
検索データから、店舗データをリストとして表示します。

##### UIの表示やユーザ操作を検知するクラス（SearchResultActivity・SearchResultListAdapter）
- 検索条件入力画面で作成した検索データを使用して、店舗データをリスト（RecyclerView）として表示します。
- リストを作成する際は、SearchResultListAdapterを用いて、Itemの設定を行います。
- Itemは、店舗トップ写真・店舗名＋ジャンル・ディナー予算・交通アクセスで構成されており、リストに表示します。
- Itemを押すと、店舗詳細画面に画面遷移します。
- ホットペッパーAPIキーが間違っている場合は、「APIキーが正しく入力されていません」とエラーメッセージが表示されます。
- 周辺の店舗件数が0件の場合は、「周辺にレストランがありません。検索範囲を広げてください」とエラーメッセージが表示されます。
- Backキーを押すと、予算の選択を行う画面に画面遷移します。

##### 店舗データの管理・保存するクラス（GourmetShopViewModel）
- ホットペッパーAPIから受け取った店舗データを管理します。
- SearchResultActivityから受け取った検索データを用いて、ホットペッパーAPIから周辺の店舗データを取得します。そのデータをLiveDataのobserveを用いて、SearchResultActivityで画面を更新します。

##### ホットペッパーAPIからデータの取得するクラス（GourmetShopRepository・HotPepperGourmetService）
- ホットペッパーAPIから店舗データを取得するために、Retrofit2の設定を行います。受け取ったJSON形式のデータはGsonを用いてパースします。
- HotPepperGourmetServiceは、検索クエリの設定を行います。レスポンスとして受け取る店舗データの設定は、GourmetShopで行います。
<br>

#### 店舗詳細画面（MVVM：ShopDetailActivity ⇔ TelViewModel ⇔ TelRepository）
リストから選択された店舗の詳細を表示します。

##### UIの表示やユーザ操作を検知するクラス（ShopDetailActivity）
- 検索結果画面で押されたItemの店舗詳細を表示します。
- 店舗トップ写真・店舗名・営業時間・住所・ジャンル・最寄り駅・予算・電話番号・魅力が表示されます。電話番号と魅力の中身が空文字の時は、非表示となります。
- 地図検索ボタンを押すと、住所が地図アプリに渡され、住所の地点が表示されます。

##### 電話番号と店舗名の管理・保存するクラス（TelViewModel）
- YahooAPIから受け取った電話番号と店舗名を管理します。
- ShopDetailActivityから受け取った店舗名を用いて、YahooAPIから電話番号と店舗名を取得します。
- YahooAPIから受け取った結果には、検索した店舗名に似ている名前も含まれているため、店舗名と完全に一致した名前の電話番号だけを変数に格納します。
- DataBindingを用いて、TelViewModelの変数を表示します。

##### YahooAPIからデータの取得するクラス（TelRepository・YahooService）
- YahooAPIから電話番号と店舗名を取得するために、Retrofit2の設定を行います。受け取ったJSON形式のデータはGsonを用いてパースします。
- YahooServiceは、検索クエリの設定を行います。レスポンスとして受け取るデータの設定は、ShopTelで行います。 
<br>

### 使用しているAPI、SDK、ライブラリなど
- Data Binding
- ViewModel
- LiveData
- Coroutine
- Retrofit2
- Gson
- Glide
- RecyclerView

### アーキテクチャパターン
- MVVM（Model View ViewModel）
<br>

## コンセプトやポイント
### コンセプト
子供から大人まで、幅広い年齢層から使ってもらえるレストラン検索アプリ

### こだわったポイント
- 検索条件入力画面（APIキー・予算・検索範囲の入力）を3つの画面に分け、画面ごとの選択肢の数を減らすことで、画面ごとの入力に必要な労力を減らしました。
- ユーザの離脱を防ぐために、GPSの検索時にスピナー（ProgressBar）を用いて、読み込み時間を表現しました。
- 店舗詳細画面で地図検索を行えるボタンを付けたことにより、住所を覚えなくても、店舗までの経路を検索できるようにしました。
- MVVMを用いることにより、各クラスの役割を明確し、データを管理しやすくしました。
- DataBindingを用いることにより、コードの量を少なくし、コードの視認性や保守性を高めました。

### デザイン面でこだわったポイント
- 検索条件の選択にボタンを用いて、文字入力を減らしたことにより、子供でも簡単に使いこなせるUIにしました。
- 検索条件入力画面で画像（鍵・GPS）を表示することにより、各画面で何を入力・選択する必要があるのか、瞬時に把握できるようにしました。
- アプリが外で利用されることを考慮して、親指（片手持ち）で操作しやすい位置に、検索条件の選択を行うボタンを配置しました。

### アドバイスして欲しいポイント
- RecyclerViewのAdapterでItemの設定をする際に、DataBindingを用いて設定する方法がわからないので、アドバイスが欲しいです。
- GPSにより位置情報を検出する際に、GPS機能利用の許可を行うダイアログは表示できるのですが、GPS自体の利用をONにする方法がわからないため、アドバイスをお願いします。
- 検索条件入力画面の３つの画面（APIキー・予算・検索範囲の入力）で画面遷移をする際に、IntentのputExtra()メソッドを用いてデータを渡しているのですが、それを使わずに、データベースのように他の場所にデータを格納したり、取得したりする方法がありましたら、アドバイスをお願いします。（扱うデータが少なかったため、今回はデータベースを使用しませんでした。）

### 自己評価
見た目や使いやすさを工夫したことにより、幅広い年齢層に愛用してもらえるアプリを作ることができたと思います。しかし、GPSの不具合やコードの冗長性が目立つため、GPSやDataBindingを理解し、これらの問題を解決したいと考えています。また、実用的なアプリを目指して、店舗の検索履歴を表示するリストと、検索履歴からよく選ぶ店舗を割り出し、検索結果画面のリストの上位に配置する処理を追加したいと考えています。
